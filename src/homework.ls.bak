class @Homework-detail extends BP.Detail-view
  create-data-manager: !-> @data-manager = new Data-manager @
  create-faces: !->
    @faces-manager = new Faces-manager @
    @faces = @faces-manager.create-faces!

class Data-manager extends BP.Detail-data-manager
  publish: !->
    dm = @
    Meteor.publish dm.meteor-pub-name, (type, id)->
      cursor = view.colloection.find if type is 'by-assignment-id' then assignment-id: id else _id: id

  subscribe: (params)->
    if params['assignment-id']
      Meteor.subscribe @pub-sub.name, type = 'by-assignment-id', @assignment-id = params['assignment-id']
    else
      Meteor.subscribe @pub-sub.name, type = 'by-id', @doc-id = params['assignment-id']

class Faces-manager extends BP.Detail-faces-manager
  create-faces: ->
    faces = super ...
    faces <<<
      update-by-assignment-id:    "/#{@name}/update-by-assignment-id/:assignment-id"
      view-by-assignment-id:      "/#{@name}/view-by-assignment-id/:assignment-id"
      reference-by-assignment-id: "/#{@name}/reference-by-assignment-id/:assignment-id"

  get-path: (pattern, doc-or-id)->
    if pattern.index-of ':assignment-id' >= 0
      pattern.replace ':assignment-id', doc.assignment-id
    else