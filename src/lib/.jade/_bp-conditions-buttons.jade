mixin _if-action(action)
  | {{#if bp-action-is '#{action}'}}
  block
  | {{/if}}

mixin _if-collection-permit(action)
  | {{#if bp-collection-permit '#{action}'}}
  block
  | {{/if}}

mixin _if-doc-permit(action)
  | {{#if bp-doc-permit this '#{action}'}}
  block
  | {{/if}}

mixin _if-attribute-permit(attr, action)
  | {{#if bp-attribute-permit this '#{attr}' #{action}}}
  block
  | {{/if}}

mixin _if-else-attribute-permit(attr, action)
  | {{#if bp-attribute-permit this '#{attr}' #{action}}}
  block

mixin _else()
  | {{else}}
  block
  | {{/if}}

//- button和link-button的本质区别在于，link本质是导航，不对数据进行任何操作，button是操作，操作后依据结果导航
mixin _guarded-permission-and-action-button(action, label)
  +_if-action(action)
    +_guarded-permission-button(action, label)

mixin _guarded-permission-button(action, label)
  +_if-collection-permit(action)
    +_link-button(action) 
      | #{label}


mixin _link-button(action, isLink)
  - var href = isLink? ("{{bp-path-for '"+ action +"' this}}") : '#'
  - var bpDocId = action == 'delete' ? "{{_id}}" : null // 列表中出现delete按钮时，需要分清是哪个doc
  a(href=href, class='bp-#{action}', bp-doc-id=bpDocId)
    case action
      when 'create': i.fa.fa-plus.fa-fw 
      when 'update': i.fa.fa-pencil.fa-fw 
      when 'delete': i.fa.fa-trash-o.fa-fw 
      defaule: i
    block

mixin _guarded-link(action)
  +_if-collection-permit(action)
    +_link-button(action, true)
