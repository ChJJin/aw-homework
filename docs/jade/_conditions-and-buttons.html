<!DOCTYPE html>

<html>
<head>
  <title>_conditions-and-buttons.jade</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="frame.html">
                frame.jade
              </a>
            
              
              <a class="source" href="_component.html">
                _component.jade
              </a>
            
              
              <a class="source" href="_conditions-and-buttons.html">
                _conditions-and-buttons.jade
              </a>
            
              
              <a class="source" href="_constants-and-utils.html">
                _constants-and-utils.jade
              </a>
            
              
              <a class="source" href="_form.html">
                _form.jade
              </a>
            
              
              <a class="source" href="_table.html">
                _table.jade
              </a>
            
              
              <a class="source" href="_template.html">
                _template.jade
              </a>
            
              
              <a class="source" href="bp-mixins.html">
                bp-mixins.jade
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>_conditions-and-buttons.jade</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p> 条件wrappers。帮助BP插入权限控制helpers， 参考：<a href="../ls/adapter.html">adpater.ls</a>, <a href="../ls/permission.html">permission.ls</a></p>
<p>控制仅在某个face中显示</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>mixin <span class="keyword">if</span>-face(face)
  | {{<span class="comment">#if bp-face-is '#{face}'}}</span>
  block
  | {{/<span class="keyword">if</span>}}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>是否允许当前用户对数据（默认为当前，除非给出citedDoc），进行某种操作（go-create, go-update, create, update, view; 以及其它用户通过add-links增加的action）</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>mixin <span class="keyword">if</span>-bp-permit(action, citedDoc)
  - <span class="reserved">var</span> citedDocStr = attributes.citedDoc ? <span class="string">"'"</span> + attributes.citedDoc + <span class="string">"'"</span> : <span class="string">''</span>
  | {{<span class="comment">#if bp-permit this '#{action}' #{citedDocStr}}}</span>
  block
  | {{/<span class="keyword">if</span>}}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>是否允许当前用户对当前（默认为当前，除非给出citedDoc）的某个属性（attr），进行某种操作</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>mixin <span class="keyword">if</span>-bp-attribute-permit(attr, action)
  - <span class="reserved">var</span> citedDoc = attributes.citedDoc ? attributes.citedDoc : <span class="string">''</span>
  | {{<span class="comment">#if bp-attribute-permit this '#{attr}' '#{action}' '#{citedDoc}'}}</span>
  block
  | {{/<span class="keyword">if</span>}}


mixin <span class="keyword">if</span>-<span class="keyword">else</span>-attribute-permit(attr, action)
  | {{<span class="comment">#if bp-attribute-permit this '#{attr}' '#{action}'}}</span>
  block
    
<span class="regexp">//- 和上面的if-else-attribute-permit配合一同使用
mixin else()
  | {{else}}
  block
  | {{/if}}

mixin mark-current-doc-id()
  .current-doc-id(bp-doc-id='{{_id}}')
    block

mixin guarded-button(action, label)
  +if-bp-permit(action)(attributes)
    - attributes.isButton = true
    +link-button(action, null, true)(attributes) 
      if label
        | <span class="comment">#{label}</span>

mixin link-button(action, href, isLink, label)
  - var path = attributes.path ? attributes.path : action
  - var href = href || (isLink ? ("{{bp-path-for '"+ path.camelize(false) +"' this}}") : '<span class="comment">#')</span>
  - var tooltip = attributes.label ? attributes.label : '' //</span> 将label作为tooltip显示
  - <span class="reserved">var</span> classNames = <span class="string">'bp-'</span> + action + <span class="string">' '</span> + (attributes.classNames ? attributes.classNames : <span class="string">''</span>)
  - classNames = attributes.isButton ? <span class="string">"ui icon tiny button "</span> + classNames : classNames <span class="regexp">// Semantic UI button
  - if(action == 'delete'){var bpDocId ="{{_id}}"} //</span> 列表中出现<span class="keyword">delete</span>按钮时，需要分清是哪个doc
  a(href=href, <span class="class"><span class="keyword">class</span>=<span class="title">classNames</span>, <span class="title">title</span>=<span class="title">tooltip</span>, <span class="title">bp-doc-id</span>=<span class="title">bpDocId</span>)</span>
    - <span class="keyword">if</span>(action == <span class="string">'next'</span>) <span class="regexp">// next的文字出现在前面，图标在后面，和其它相反
      block
      i.fa.fa-arrow-right.fa-fw
    - else
      case action
        when 'go'         :   i.fa.fa-reply.fa-fw 
        when 'create'     :   i.fa.fa-plus.fa-fw 
        when 'go-create'  :   i.fa.fa-plus.fa-fw 
        when 'go-update'  :   i.fa.fa-pencil.fa-fw 
        when 'delete'     :   i.fa.fa-trash-o.fa-fw 
        when 'previous'   :   i.fa.fa-arrow-left.fa-fw
        defaule: i
      block

mixin guarded-link(action)
  +if-bp-permit(action)(attributes)
    +link-button(action, null, true)(attributes)

mixin previous-link()
  | {{<span class="comment">#if bp-pre-link}}</span>
  +link-button('previous', '{{bp-pre-link}}')
    | 上一条
  | {{/if}} 

mixin next-link()
  | {{<span class="comment">#if bp-next-link}}</span>
  +link-button('next', '{{bp-next-link}}')
    | 下一条
  | {{/if}}

//</span>- mixin show-reference(ref, query)
<span class="regexp">//-   - var referredViewName = bp.getRefName(ref)
//</span>-   - <span class="keyword">if</span>(references.none(referredViewName)){references.push({<span class="attribute">referredViewName</span>: <span class="string">'homework'</span>, <span class="attribute">query</span>: query});} <span class="regexp">// 一个reference可在多个域标注
//</span>-   i.fa.fa-info.reference(bp-view-name = <span class="string">'ref-'</span> + referredViewName)

mixin add-addtional-links(links)
  - view.additionalLinks = view.additionalLinks ? view.additionalLinks : []
  each link <span class="keyword">in</span> links
    - view.additionalLinks.push(link)
    - <span class="reserved">var</span> isNegative = link.guard[<span class="number">0</span>] == <span class="string">'!'</span>
    - <span class="keyword">if</span>(isNegative){link.guard = link.guard.from(<span class="number">1</span>)}
    - console.log(<span class="string">"isNegative: "</span>, isNegative, link.guard, link.context)
    <span class="keyword">if</span> isNegative
      | {{<span class="comment">#unless #{link.guard}}}</span>
      +_<span class="reserved">with</span>-<span class="keyword">or</span>-without-context(link)
      | {{/<span class="keyword">unless</span>}}
    <span class="keyword">else</span>
      | {{<span class="comment">#if #{link.guard}}}</span>
      +_<span class="reserved">with</span>-<span class="keyword">or</span>-without-context(link)
      | {{/<span class="keyword">if</span>}}

mixin _<span class="reserved">with</span>-<span class="keyword">or</span>-without-context(link)
  - <span class="reserved">var</span> citedDoc = link.to.split(<span class="string">'.'</span>)[<span class="number">0</span>]
  - <span class="reserved">var</span> citedViewType = link.to.split(<span class="string">'.'</span>)[<span class="number">1</span>]
  <span class="keyword">if</span> link.context
    | {{<span class="comment">#with #{link.context}}}</span>
    +guarded-link(link.icon)(path=link.path, label=link.label, citedDoc=citedDoc, citedViewType=citedViewType)
    | {{/<span class="reserved">with</span>}}
  <span class="keyword">else</span>
    +guarded-link(link.icon)(path=link.path, label=link.label, citedDoc=citedDoc, citedViewType=citedViewType)</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
